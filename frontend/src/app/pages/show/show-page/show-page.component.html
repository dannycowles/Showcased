<div class="container text-white" style="margin-top: -0.5rem;">
  @if (show) {
    <div class="backdrop-container">
      <img id="backdrop-image" [ngSrc]="show.backdropPath" alt="Show Backdrop" width="1280" height="720" priority>
    </div>

    <div class="d-flex gap-4 mb-5">
      <div class="d-flex flex-column align-items-start">
        <!-- Poster images are sized w500, using 2:3 ratio -->
        <img class="ms-2" [ngSrc]="show.posterPath" alt="Poster Image" width="250" height="375" priority>

        <div id="watch-options" style="margin-bottom: 2rem">
          @if (show.streamingOptions.length != 0) {
            <h5 class="mt-3">Streaming on</h5>
            <div class="d-flex gap-2 mb-3">
              @for (service of show.streamingOptions; track service.name) {
                <img class="watch-logo" [ngSrc]="service.logoPath" alt="Service Logo" width="40" height="40">
              }
            </div>
          }

          @if (show.buyOptions.length != 0) {
            <h5>Buy on</h5>
            <div class="d-flex gap-2">
              @for (service of show.buyOptions; track service.name) {
                <img class="watch-logo" [ngSrc]="service.logoPath" alt="Service Logo" width="40" height="40">
              }
            </div>
          }
        </div>

        <div ngbDropdown>
          <button type="button" class="btn btn-primary d-flex gap-4 align-items-center" id="seasons-dropdown" ngbDropdownToggle>
            Select Season
            <img ngSrc="chevron-down.svg" width="20" height="20" alt="">
          </button>
          <div ngbDropdownMenu aria-labelledby="seasons-dropdown">
            @for (_ of [].constructor(show.numSeasons); let season = $index; track season) {
              <button [routerLink]="['season', season + 1]" ngbDropdownItem>Season {{season + 1}}</button>
            }
          </div>
        </div>
      </div>

      <div class="w-100" id="show-info">
        <div class="d-flex justify-content-between align-items-start">
          <div class="d-flex flex-column">
            <div class="d-flex align-items-center gap-2">
              <h1 class="fw-bolder mb-0">{{show.title}}</h1>
              <h5 class="mb-0">{{showYears}}</h5>
            </div>

            <div class="d-flex align-items-center gap-2">
              <span>{{show.numSeasons}} Seasons</span>
              <div class="circle-divider"></div>
              <div>
                @for (genre of show.genres; let last = $last; track genre.id) {
                  {{genre.name}}
                  @if (!last) {
                    <span>, </span>
                  }
                }
              </div>
              <div class="circle-divider"></div>
              <span>{{show.rating}}</span>
            </div>
            <span class="my-3 fst-italic fs-5">{{show.tagline}}</span>
            <span class="fs-5">{{show.plot}}</span>
            <span class="my-3" style="font-size: 1.1rem">{{show.awards}}</span>
          </div>

          <div id="rating-info" class="d-flex gap-3 align-items-center">
            <div class="d-flex flex-column align-items-center">
              <div class="d-flex align-items-center gap-2">
                <img class="star" ngSrc="star.svg" alt="Star icon" width="25" height="25">
                <h4 class="text-reset mb-0">{{show.imdbRating}}</h4>
              </div>
              <h5 style="font-size: 0.75rem">{{show.imdbVotes}}</h5>
            </div>
            <img ngSrc="imdb.svg" alt="IMDB icon" width="35" height="35">
          </div>
        </div>

        <div class="d-flex align-items-center justify-content-between mt-3">
          <div id="add-buttons" class="d-flex flex-column align-items-start gap-3">
            <button type="button" class="btn btn-primary add-button" (click)="openAddReviewModal()">
              <img ngSrc="pencil.svg" width="20" height="20" alt="">
              <span>Write a review</span>
            </button>

            @if (show.isOnWatchlist) {
              <button type="button" class="btn btn-primary add-button" (click)="removeShowFromWatchlist()">
                <img ngSrc="bookmark.svg" width="20" height="20" alt="">
                <span>Remove from watchlist</span>
              </button>
            } @else {
              <button type="button" class="btn btn-primary add-button" (click)="addShowToWatchlist()">
                <img ngSrc="bookmark.svg" width="20" height="20" alt="">
                <span>Add to watchlist</span>
              </button>
            }

            @if (show.isOnWatchingList) {
              <button type="button" class="btn btn-primary add-button" (click)="removeShowFromWatchingList()">
                <img ngSrc="show-tv.svg" width="20" height="20" alt="">
                <span>Remove from watching</span>
              </button>
            } @else {
              <button type="button" class="btn btn-primary add-button" (click)="addShowToWatchingList()">
                <img ngSrc="show-tv.svg" width="20" height="20" alt="">
                <span>Add to watching</span>
              </button>
            }

            @if (show.isOnRankingList) {
              <button type="button" class="btn btn-primary add-button" (click)="removeShowFromRankingList()">
                <img ngSrc="trophy.svg" width="20" height="20" alt="">
                <span>Remove from ranking</span>
              </button>
            } @else {
              <button type="button" class="btn btn-primary add-button" (click)="addShowToRankingList()">
                <img ngSrc="trophy.svg" width="20" height="20" alt="">
                <span>Add to ranking</span>
              </button>
            }

            <button type="button" class="btn btn-primary add-button" (click)="openAddToCollectionModal()">
              <img ngSrc="collection.svg" width="20" height="20" alt="">
              <span>Add to collection</span>
            </button>
          </div>

          <div>
            <h4 class="text-reset">User ratings</h4>
            <app-review-chart [reviewDistribution]="show.reviewDistribution"></app-review-chart>
          </div>
        </div>

      </div>
    </div>

    <!-- Navigation tabs -->
    <ul class="nav nav-tabs custom-tabs mb-4" id="show-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews-tab-pane" type="button" role="tab" aria-controls="reviews-tab-pane" aria-selected="true">Reviews</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="trailer-tab" data-bs-toggle="tab" data-bs-target="#trailer-tab-pane" type="button" role="tab" aria-controls="trailer-tab-pane" aria-selected="false">Trailer</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="cast-tab" data-bs-toggle="tab" data-bs-target="#cast-tab-pane" type="button" role="tab" aria-controls="cast-tab-pane" aria-selected="false">Cast & Creator(s)</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="similar-tab" data-bs-toggle="tab" data-bs-target="#similar-tab-pane" type="button" role="tab" aria-controls="similar-tab-pane" aria-selected="false">Similar shows</button>
      </li>
    </ul>

    <div class="tab-content" id="show-tabs-content" style="margin-bottom: 15vh">
      <div class="tab-pane show active" id="reviews-tab-pane" role="tabpanel" aria-labelledby="reviews-tab" tabindex="0">
        <div class="d-flex my-3 align-items-center">
          <h3 class="section-header">Reviews</h3>
          <div class="ms-auto">
            <div class="dropdown ms-auto">
              <span class="fs-4 me-4">Sort</span>
              <button id="sort-dropdown" class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="me-3">{{ selectedSort.label }}</span>
                <img ngSrc="chevron-down.svg" alt="" height="20" width="20">
              </button>
              <ul class="dropdown-menu">
                @for (sortOption of sortReviewOptions; track sortOption.value) {
                  <li><a class="dropdown-item" (click)="setSort(sortOption)">{{ sortOption.label }}</a></li>
                }
              </ul>
            </div>
          </div>
        </div>
        @if (reviews?.content.length) {
          <div class="reviews"
               infiniteScroll
               [infiniteScrollDistance]="1"
               (scrolled)="loadMoreReviews()"
          >
            @for (review of reviews.content; track review.id) {
              <app-review [review]="review" [reviewType]="ReviewType.Show" [isLoggedIn]="isLoggedIn" (deleteReview)="handleDeleteReview($event)"></app-review>
              <hr>
            }
          </div>
        } @else {
          <h4 class="text-reset">No reviews for this show</h4>
        }
      </div>

      <div class="tab-pane" id="trailer-tab-pane" role="tabpanel" aria-labelledby="trailer-tab" tabindex="0">
        <h3 class="section-header">Trailer</h3>
        @if (safeTrailerUrl) {
          <iframe  [src]="safeTrailerUrl" width="560" height="315" allowfullscreen></iframe>
        }
      </div>

      <div class="tab-pane" id="cast-tab-pane" role="tabpanel" aria-labelledby="cast-tab" tabindex="0">
        <h3 class="section-header">Cast</h3>
        <div class="mb-3">
          @if (show.cast.length != 0) {
            <div class="d-flex flex-wrap justify-content-start gap-5">
              @for (cast of show.cast; track cast.id) {
                <div class="text-center lh-1">
                  <!-- Profile images are sized w185, using 2:3 ratio -->
                  <img class="crew-image mb-2" [ngSrc]="cast.profilePath" alt="Actor Picture" width="139" height="209" priority>
                  <h5>{{cast.name}}</h5>
                  <p>as {{cast.character}}</p>
                </div>
              }
            </div>
          } @else {
            <h4 class="text-reset">No Cast Found</h4>
          }
        </div>

        <h3 class="section-header">Creator(s)</h3>
        <div>
          @if (show.creators.length != 0) {
            <div class="d-flex flex-wrap justify-content-start gap-5">
              @for (creator of show.creators; track creator.id) {
                <div class="text-center">
                  <!-- Profile images are sized w185, using 2:3 ratio -->
                  <img class="crew-image mb-2" [ngSrc]="creator.profilePath" alt="Actor Picture" width="139" height="209" priority>
                  <h5>{{creator.name}}</h5>
                </div>
              }
            </div>
          } @else {
            <h4 class="text-reset">No Creators Found</h4>
          }
        </div>
      </div>

      <div class="tab-pane" id="similar-tab-pane" role="tabpanel" aria-labelledby="similar-tab" tabindex="0">
        <h3 class="section-header">You might like...</h3>
        <div id="similar-container" class="d-flex flex-wrap">
          @for (show of show.recommendations; track show.id) {
            <a [routerLink]="['/show', show.id]">
              <img class="poster-image" [ngSrc]="show.posterPath" alt="Show Recommendation Picture" width="185" height="278">
            </a>
          }
        </div>
      </div>
    </div>
  }
</div>

